<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="assets/bytestorelogo.svg" type="image/svg+xml" />
    <title>Admin Dashboard - byteStore</title>
    <meta
      name="description"
      content="byteStore Admin — Manage products, inventory, and more."
    />

    <!-- Inter Font -->
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <!-- Franken UI CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/franken-ui@2.0.0/dist/css/core.min.css"
    />
    <!-- Tailwind Play CDN -->
    <script>
      const _tw_warn = console.warn;
      console.warn = (...args) => {
        if (
          typeof args[0] === "string" &&
          args[0].includes("cdn.tailwindcss.com")
        )
          return;
        _tw_warn.apply(console, args);
      };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: "hsl(var(--primary))",
              "primary-foreground": "hsl(var(--primary-foreground))",
              muted: "hsl(var(--muted))",
              "muted-foreground": "hsl(var(--muted-foreground))",
              card: "hsl(var(--card))",
            },
          },
        },
      };
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <!-- Theme init (prevent FOUC) -->
    <script>
      if (localStorage.getItem("theme") === "dark")
        document.documentElement.classList.add("dark");
      document.documentElement.classList.add(
        "uk-theme-zinc",
        "uk-radii-md",
        "uk-shadows-sm",
        "uk-font-sm",
      );
    </script>
  </head>
  <body class="bg-background text-foreground">
    <main>
      <!-- Admin Header -->
      <section class="uk-container py-8">
        <div
          class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"
        >
          <div>
            <h1 class="text-2xl font-bold flex items-center gap-2">
              <i
                data-lucide="shield"
                class="h-6 w-6"
                style="color: hsl(var(--primary))"
              ></i>
              Admin Dashboard
            </h1>
            <p class="text-sm text-muted-foreground mt-1">
              Manage products, inventory, and more.
            </p>
          </div>
          <button
            onclick="openAddModal()"
            class="uk-btn uk-btn-primary uk-btn-md"
          >
            <i data-lucide="plus" class="h-4 w-4 mr-2"></i> Add Product
          </button>
        </div>

        <!-- Stats Grid -->
        <div
          id="admin-stats"
          class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8"
        >
          <!-- Filled by JS -->
        </div>

        <!-- Search & Filter Bar -->
        <div class="flex flex-col sm:flex-row gap-3 mb-6">
          <div class="flex-1 relative">
            <i
              data-lucide="search"
              class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
            ></i>
            <input
              type="text"
              id="admin-search"
              placeholder="Search products by name, brand..."
              class="uk-input pl-10 w-full"
            />
          </div>
          <select
            id="admin-filter-category"
            class="uk-select"
            style="max-width: 180px"
          >
            <option value="">All Categories</option>
            <option value="laptop">Laptops</option>
            <option value="phone">Phones</option>
            <option value="audio">Audio</option>
            <option value="accessory">Accessories</option>
          </select>
        </div>

        <!-- Products Table -->
        <div class="uk-card overflow-hidden">
          <div class="overflow-x-auto">
            <table class="admin-table w-full">
              <thead>
                <tr>
                  <th class="admin-th" style="width: 60px">Image</th>
                  <th class="admin-th">Product</th>
                  <th class="admin-th" style="width: 120px">Category</th>
                  <th class="admin-th" style="width: 130px">Price</th>
                  <th class="admin-th" style="width: 80px">Stock</th>
                  <th class="admin-th" style="width: 90px">Actions</th>
                </tr>
              </thead>
              <tbody id="admin-product-tbody">
                <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!-- Add / Edit Product Modal -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <div id="product-modal" class="admin-modal-overlay hidden">
      <div class="admin-modal">
        <div class="flex justify-between items-center mb-6">
          <h2 id="modal-title" class="text-lg font-bold">Add New Product</h2>
          <button
            onclick="closeModal()"
            class="uk-btn uk-btn-ghost uk-btn-icon uk-btn-sm"
          >
            <i data-lucide="x" class="h-5 w-5"></i>
          </button>
        </div>

        <form id="product-form" class="space-y-4">
          <div>
            <label class="text-sm font-medium mb-1 block">Product Name *</label>
            <input
              type="text"
              id="pf-name"
              class="uk-input w-full"
              required
              placeholder='e.g. MacBook Pro 14"'
            />
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium mb-1 block"
                >Price (EGP) *</label
              >
              <input
                type="number"
                id="pf-price"
                class="uk-input w-full"
                required
                min="0"
                step="0.01"
                placeholder="29999"
              />
            </div>
            <div>
              <label class="text-sm font-medium mb-1 block">Stock *</label>
              <input
                type="number"
                id="pf-stock"
                class="uk-input w-full"
                required
                min="0"
                value="0"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium mb-1 block">Category *</label>
              <select id="pf-category" class="uk-select w-full" required>
                <option value="">Select...</option>
                <option value="laptop">Laptop</option>
                <option value="phone">Phone</option>
                <option value="audio">Audio</option>
                <option value="accessory">Accessory</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium mb-1 block">Brand</label>
              <input
                type="text"
                id="pf-brand"
                class="uk-input w-full"
                placeholder="e.g. Apple"
              />
            </div>
          </div>

          <div>
            <label class="text-sm font-medium mb-1 block">Product Image</label>
            <!-- Hidden file picker -->
            <input
              type="file"
              id="pf-image-file"
              accept="image/png,image/jpeg,image/webp,image/gif"
              class="hidden"
              onchange="uploadProductImage(this)"
            />
            <div class="flex gap-2 items-center">
              <button
                type="button"
                id="upload-image-btn"
                onclick="document.getElementById('pf-image-file').click()"
                class="uk-btn uk-btn-default uk-btn-sm shrink-0 flex items-center gap-1.5"
              >
                <i data-lucide="upload" class="h-4 w-4"></i> Upload Image
              </button>
              <input
                type="url"
                id="pf-image"
                class="uk-input w-full"
                placeholder="https://… (auto-filled after upload)"
              />
            </div>
            <p
              id="upload-status"
              class="text-xs text-muted-foreground mt-1 hidden"
            ></p>
          </div>

          <div>
            <label class="text-sm font-medium mb-1 block">Description</label>
            <textarea
              id="pf-description"
              class="uk-textarea w-full"
              rows="3"
              placeholder="Product description (supports Markdown)"
            ></textarea>
          </div>

          <div>
            <label class="text-sm font-medium mb-1 block"
              >Specs (Markdown table)</label
            >
            <textarea
              id="pf-specs"
              class="uk-textarea w-full"
              rows="3"
              placeholder="| Spec | Value |&#10;|------|-------|&#10;| CPU  | M3 Pro |"
            ></textarea>
          </div>

          <div class="flex justify-end gap-3 pt-2">
            <button
              type="button"
              onclick="closeModal()"
              class="uk-btn uk-btn-default uk-btn-sm"
            >
              Cancel
            </button>
            <button
              type="submit"
              id="save-product-btn"
              class="uk-btn uk-btn-primary uk-btn-sm"
            >
              <i data-lucide="save" class="h-4 w-4 mr-1"></i> Save Product
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!-- Delete Confirmation Modal -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <div id="delete-modal" class="admin-modal-overlay hidden">
      <div class="admin-modal" style="max-width: 420px">
        <div class="text-center">
          <div
            class="w-14 h-14 mx-auto mb-4 rounded-full flex items-center justify-center"
            style="background: hsl(0 84% 60%/0.1)"
          >
            <i
              data-lucide="alert-triangle"
              class="h-7 w-7"
              style="color: hsl(0 84% 60%)"
            ></i>
          </div>
          <h2 class="text-lg font-bold mb-2">Delete Product</h2>
          <p class="text-sm text-muted-foreground mb-6">
            Are you sure you want to delete
            <strong id="delete-product-name"></strong>? This action cannot be
            undone.
          </p>
          <div class="flex justify-center gap-3">
            <button
              onclick="closeDeleteModal()"
              class="uk-btn uk-btn-default uk-btn-sm"
            >
              Cancel
            </button>
            <button
              id="confirm-delete-btn"
              class="uk-btn uk-btn-sm"
              style="background: hsl(0 84% 60%); color: white"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Franken UI JS -->
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/franken-ui@2.0.0/dist/js/core.iife.js"
    ></script>
    <!-- App JS -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/router.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/chatbot.js"></script>
  </body>
</html>
